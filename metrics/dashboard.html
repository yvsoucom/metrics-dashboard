<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GitHub Repo Metrics Dashboard</title>
  <script src="chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    canvas { max-width: 800px; margin-bottom: 2em; }
    h2 { margin-top: 2em; }
  </style>
</head>
<body>
  <h1>📊 GitHub Metrics Dashboard</h1>

  <h2>⭐ Stars, 🍴 Forks, 👁️ Watchers</h2>
  <canvas id="repoChart"></canvas>

  <h2>📥 Clones (Last 14 Days)</h2>
  <canvas id="cloneChart"></canvas>

  <script>
    async function loadCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',');
      return lines.slice(1).map(line => {
        const values = line.split(',');
        return headers.reduce((obj, key, i) => {
          obj[key] = isNaN(values[i]) ? values[i] : +values[i];
          return obj;
        }, {});
      });
    }

    async function renderCharts() {
      const repoStats = await loadCSV('repo-stats.csv');
      const cloneStats = await loadCSV('clone-stats.csv');

      const dates = repoStats.map(row => row.date);
      const stars = repoStats.map(row => row.stars);
      const forks = repoStats.map(row => row.forks);
      const watchers = repoStats.map(row => row.watchers);

      const ctxRepo = document.getElementById('repoChart').getContext('2d');
      new Chart(ctxRepo, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [
            { label: 'Stars ⭐', data: stars, borderColor: 'gold', fill: false },
            { label: 'Forks 🍴', data: forks, borderColor: 'purple', fill: false },
            { label: 'Watchers 👁️', data: watchers, borderColor: 'green', fill: false }
          ]
        },
        options: { responsive: true }
      });

      const ctxClone = document.getElementById('cloneChart').getContext('2d');
      new Chart(ctxClone, {
        type: 'bar',
        data: {
          labels: cloneStats.map(r => r.date),
          datasets: [
            {
              label: 'Total Clones',
              data: cloneStats.map(r => r.clones),
              backgroundColor: 'steelblue'
            },
            {
              label: 'Unique Cloners',
              data: cloneStats.map(r => r.unique_cloners),
              backgroundColor: 'orange'
            }
          ]
        },
        options: { responsive: true }
      });
    }

    renderCharts();
  </script>
</body>
</html>
